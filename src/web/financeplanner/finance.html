<!doctype html>
<html>
<head>
  <title>Matt's Finance Planner</title>
  <script type="text/javascript" src="jquery1.7.2.js"></script>
  <script type="text/javascript" src="finance.js"></script>
  <script type="text/javascript" src="display.js"></script>
  <link rel="stylesheet" type="text/css" href="finance.css" />
</head>
 <body>

 <div id="choose">
  <select id="cashflows">
  </select>

  name:<input id="cashflowname"></input>
  <button id="newcashflow">Create new</button>
 </div>

 <div id="current">
  <table id="pertrans" border="2"></table>
 </div>

 <div id="calculations">
   <table id="results" border="2"></table>
 </div>

 <script type="text/javascript">

 $(document).ready(function() {

  var analysis = new Analysis();
  var cfview = new CashFlowView(analysis);
    
  var gview = new GridView();
  var aview = new AnalyzeView();
  
  analysis.addListener(function(data) {
    if(data.message === "setActiveCashFlow") {
      var cf = analysis.getCashFlow(data.name);
      gview.setCashFlow(cf);
      aview.setCashFlow(cf);
    }
  });  
  
  var cflow = new CashFlow("default");
  analysis.addCashFlow(cflow);
  analysis.setActiveCashFlow("default");
//  gview.setCashFlow(cflow);
//  aview.setCashFlow(cflow);

  
  $("#newcashflow").click(function() {
    analysis.addCashFlow(new CashFlow($("#cashflowname").val()));
  });

  $("#cashflows").change(function() {
    var cfname = $(this).val();     // currently selected ... should this make a call to cfview instead of using jQuery?
    var cf = analysis.getCashFlow(cfname); // use it to look up the CashFlow
    gview.setCashFlow(cf);                 // ... these could also be implemented using listeners instead ...
    aview.setCashFlow(cf);
  });

 });

 </script>
 </body>
</html>