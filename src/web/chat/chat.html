<!doctype html>
<html>
<head>
  <title>the Fenwick Chat Machine</title>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
  <script type="text/javascript" src="chat.js"></script>
  <script type="text/javascript" src="model.js"></script>
  <link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body>


 <div id="wrapper">

  <div id="main">
  
   <div id="messagehistory"></div>

   <div id="newmessage">
    new message:<textarea id="text"></textarea>
    <button id="savemessage">Save message</button>
   </div>
  
  </div> <!-- end #main--> 


  <div id="metainfo">
  
   <div id="config">
    <button id="showconfig">Show/hide configuration settings</button>
    <div id="setconfig">
     <table>
       <tr>
         <td>username</td>
         <td><input name="username" id="username" /></td>
       </tr>
       <tr>
         <td>room</td>
         <td><input id="room" name="room"/></td>
       </tr>
     </table>
     <button id="updateconfig">Save updated configuration</button>
    </div>
    <button id="togglestatus">Show/hide status</button>
   </div> <!--  end config -->
   
   <div id="currentconfig">
    <div id="currentusername"></div>
    <div id="currentroom"></div>
   </div>
   
   <div id="status"></div>
   
  </div> <!-- end #metainfo -->
  
  
  <div id="footer"></div>

 </div> <!--  end wrapper -->
 
 
<script type="text/javascript">

  $(document).ready(function() {
	  
	  var model = new Model("testroom", "anonymous");
	  
	  model.addListener(function(eType) {
		  if(eType == "roomandusername") {
              $("#currentroom").text("current room: " + room);	  
              $("#room").val(room);
		  }
	  });
	  
	  model.addListener(function(eType) {
	      if(eType == "roomandusername") {
	    	  $("#currentusername").text("current username: " + username);
        	  $("#username").val(username);
	      }	  
	  });
	  
      $("#savemessage").click(function() {
          var text = $("#text").val();
          model.addMessage(text);
      });

      $("#updateconfig").click(function() {
          var username = $("#username").val();
          var room = $("#room").val();
          model.setRoomAndUserName(room, username);
      });

      $("#togglestatus").click(function() {
          $("#status").toggle(500);
      });
      
      $("#showconfig").click(function() {
          $("#setconfig").toggle(500); 
      }).click();
      
      
      function fetchMessages() {
          getAllMessages(room);
      };

      function setupFetchMessages() {
          setInterval(fetchMessages, 3000);
      }

      setupFetchMessages();
  });

</script>

</body>

</html>

