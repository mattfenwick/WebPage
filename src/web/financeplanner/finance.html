<!doctype html>
<html>
<head>
  <title>Matt's Finance Planner</title>
  <script type="text/javascript" src="jquery1.7.2.js"></script>
  <script type="text/javascript" src="finance.js"></script>
  <link rel="stylesheet" type="text/css" href="finance.css" />
</head>

 <body>

 <div id="current">
  <table id="pertrans" border="2">

   <tr>
    <th></th>
    <th>Amount</th>
    <th>Description</th>
    <th>Period</th>
    <th>Debit/credit</th>
    <th></th>
   </tr>

   <tr id="newrow">
    <td><button>Create new</td>
   </tr>

  </table>
 </div>


 <div id="calculations">
   total for year: <span id="result">0</span>
 </div>

  
 <script type="text/javascript">

 $(document).ready(function() {

  var cf = new CashFlow();

  $("#newrow").click(function() {
    try {
      var ptran = new PerTran(0, "", "month", "debit");
      var id = cf.addPerTran(ptran);
      makeRow(id, ptran);
    } catch(e) {
      alert(e);
    }
  });

  function updateYearTotal() {
    $("#result").text(cf.calculateYear()); 
  }


  function makeRow(id, perTran) {

   var rowHTML = [
    '<tr id="' + id + '">',
     '<td>',
      '<button class="savepertran">Save</button>',
     '</td>',

     '<td>',
      '<input type="text" class="amount inputfield" />',
     '</td>',

     '<td>',
      '<input type="text" class="description inputfield">',
     '</td>',
 
     '<td>',
      '<select class="period inputfield">',
         '<option value="month">month</option>',
         '<option value="year">year</option>',
       '</select>',
     '</td>',

     '<td>',
      '<select class="type inputfield">',
         '<option value="credit">credit</option>',
         '<option value="debit">debit</option>',
       '</select>',
     '</td>',

     '<td>',
      '<button class="deletepertran">Delete</button>',
     '</td>',
    '</tr>'
   ].join('\n');

   $("#newrow").before(rowHTML); // put in the new row right before #newrow

   $("#" + id + " .savepertran").click(function() {
     try {
       var pt = cf.getPerTran(id);
       pt.setAmount(     $("#" + id + " .amount").val());
       pt.setDescription($("#" + id + " .description").val());
       pt.setPeriod(     $("#" + id + " .period").val());
       pt.setType(       $("#" + id + " .type").val());
       $("#" + id + " .inputfield").removeClass("redoutline");
       updateYearTotal();
     } catch(e) {
       alert("error: " + e);
     }
   });

   $("#" + id + " .deletepertran").click(function() {
     cf.removePerTran(id);
     $("#" + id).remove();
     updateYearTotal();
   });

   $("#" + id + " .amount").val(perTran.amount);

   $("#" + id + " .description").val(perTran.description);

   $("#" + id + " .period").val(perTran.period);

   $("#" + id + " .type").val(perTran.type);
  }

  $(document).on("change", ".inputfield", function() {
    $(this).addClass("redoutline");
    // save this row -- but how?  need the id
    //updateYearTotal();// until I can save the row, this line does nothing useful
  });

 });

 </script>
  
 </body>
</html>